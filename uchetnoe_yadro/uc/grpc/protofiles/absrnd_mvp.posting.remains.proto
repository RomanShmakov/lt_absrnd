syntax = "proto3";

package absrnd_mvp.posting.remains;

import "absrnd_mvp.proto";

// Управление движениями средств

message RequestPayload {

  message PostPayload {
    message Hold {
      string id = 1; // Идентификатор хода
      string amount_currency = 2; // Сумма зарезервированных средств
      string reason_code = 3; // Тип холда / причина установки холда
    }

    FundsDirection funds_direction = 1; // Направление движения средств		
    string account_id = 2; // Идентификатор счета в формате UUID
    string amount_currency = 3; // Сумма
    optional string balance_type = 4; // Тип остатка для проверки
    optional Hold hold = 5; // Информация о холде
  }

  // Удаление проводки
  message DeletePayload {
  }

  // Откат проводки
  message RollbackPayload {
  }
  
  string document_id = 1; // Внутренний идентификатор документа в формате UUID
  uint32 funds_movement_number = 2;  // Номер движения средств
  
  oneof payload {
    PostPayload post_payload = 3;
    DeletePayload delete_payload = 4;
    RollbackPayload rollback_payload = 5;
  }
}

// Статус выполнения учета
// Положительные статусы в диапозоне от 0 до 999
// Системная ошибка в диапозоне от 1000 до 1999
// Ошибка бизнес-логики от 2000 до 2999
enum ResultStatus {
  RESULT_STATUS_BALANCE_SUCCESS = 0;
  RESULT_STATUS_BALANCE_EXEEDED = 2000;
}

message ResponsePayload {
  string document_id = 1; // Внутренний идентификатор документа в формате UUID
  uint32 funds_movement_number = 2;  // Номер движения средств
  optional ResultStatus result_status = 3; // Статус операции
  optional string result_description = 4; // Сообщение
}
